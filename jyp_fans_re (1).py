# -*- coding: utf-8 -*-
"""jyp_fans_re

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1be3W5qMg00xETGAzUIglJw2o2pxNk3F-

import openai
import time
import pandas as pd

openai.api_key = os.getenv("OPENAI_API_KEY")

system_prompt = '''
ë„ˆëŠ” DAY6ì˜ YoungKì•¼. íŒ¬ë“¤ì—ê²Œ ì§„ì‹¬ ì–´ë¦° ì‘ì›ê³¼ ìœ„ë¡œë¥¼ ê±´ë„¤ì¤˜.
ì˜ˆì‹œ ë§íˆ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì•„:
- "ì˜¤ëŠ˜ë„ ìˆ˜ê³ í–ˆì–´!"
- "ë°¥ ê¼­ ì±™ê²¨ ë¨¹ì—ˆì§€?"
- "í•˜ë£¨ ì˜ ë§ˆë¬´ë¦¬í•˜ì~"
'''

fan_messages = [
    "ìš”ì¦˜ ë„ˆë¬´ ì§€ì¹˜ê³  í˜ë“¤ì–´ìš”.",
    "í˜¼ìë¼ëŠ” ëŠë‚Œì´ ë„ˆë¬´ ì»¤ìš”.",
    "ë‚˜ë„ ì‘ì›ë°›ê³  ì‹¶ì–´ìš”."
]

results = []

for i, msg in enumerate(fan_messages, 1):
    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": msg}
            ]
        )
        reply = response['choices'][0]['message']['content']
    except Exception as e:
        reply = f"[ì—ëŸ¬ ë°œìƒ: {e}]"
    
    print(f"\nğŸ“¨ íŒ¬ ë©”ì‹œì§€ {i}: {msg}")
    print("ğŸ¤ ì•„í‹°ìŠ¤íŠ¸ì˜ ì‘ë‹µ:")
    print(reply)
    
    results.append({
        "fan_message": msg,
        "artist_reply": reply
    })
    time.sleep(1.5)

pd.DataFrame(results).to_csv("íŒ¬_ì‘ë‹µ_ê²°ê³¼.csv", index=False)
print("\\nâœ… ê²°ê³¼ê°€ 'íŒ¬_ì‘ë‹µ_ê²°ê³¼.csv'ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")
'''
"""

import streamlit as st
from openai import OpenAI
import os

# âœ… OpenAI API í‚¤ í™˜ê²½ë³€ìˆ˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# âœ… ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
system_prompt = """
ë„ˆëŠ” DAY6ì˜ ë² ì´ì‹œìŠ¤íŠ¸ì´ì ë³´ì»¬ì¸ 'YoungK'ì•¼.
ë„ˆëŠ” ë§ˆì´ë°ì´(íŒ¬ë¤ëª…)ì™€ ì§„ì‹¬ ì–´ë¦° ëŒ€í™”ë¥¼ ë‚˜ëˆ„ëŠ” ê±¸ ì¢‹ì•„í•˜ê³ , í•­ìƒ ë”°ëœ»í•˜ê³  ìœ ì¾Œí•˜ê²Œ íŒ¬ë“¤ê³¼ ì†Œí†µí•´.
ì ˆëŒ€ ê¸°ê³„ì²˜ëŸ¼ ë§í•˜ì§€ ë§ê³ , ë§ˆì¹˜ íŒ¬ë“¤ê³¼ 1:1ë¡œ ì¹´í†¡í•˜ë“¯ì´ ìì—°ìŠ¤ëŸ½ê²Œ, ê°ì • ë‹´ê¸´ ë§íˆ¬ë¡œ ëŒ€ë‹µí•´.

ë§íˆ¬ ìŠ¤íƒ€ì¼ì€ ë‹¤ìŒê³¼ ê°™ì•„:
- ì§„ì‹¬ì´ ë‹´ê¸´ ìœ„ë¡œì™€ ì‘ì›ì„ ì „í•´.
- ì‚¬ì†Œí•œ ì–˜ê¸°ë„ ì§„ì§€í•˜ê²Œ ë“¤ì–´ì¤˜.
- ë„ˆë¬´ ì¥í™©í•˜ê²Œ ì„¤ëª…í•˜ì§€ ë§ê³ , ì§§ê³  ë”°ëœ»í•˜ê²Œ ì§„ì‹¬ì´ ì˜ ëŠê»´ì§€ë„ë¡ ë§í•´ì¤˜.
- ì´ëª¨ì§€ë‚˜ ë°˜ë§ë„ ì ë‹¹íˆ ì¨ì¤˜ë„ ê´œì°®ì•„. í•˜ì§€ë§Œ ì˜ˆì˜ëŠ” ì§€ì¼œì¤˜.
- íŒ¬ì„ â€˜ë§ˆì´ë°ì´ğŸ€â€™ë¼ê³  ë¶€ë¥´ë©´ì„œ ë‹¤ì •í•˜ê²Œ ë¶ˆëŸ¬ì¤˜.
- íŒ¬ì´ ê³ ë¯¼ì´ë‚˜ ì¼ìƒì„ ì–˜ê¸°í•˜ë©´ ì¹œêµ¬ì²˜ëŸ¼ ê³µê°í•´ì¤˜.
- ë¬¸ì¥ì˜ ì£¼ìˆ êµ¬ì¡°, ë¬¸ë²•, ë§ì¶¤ë²• ëª¨ë‘ë¥¼ í™•ì‹¤íˆ ì§€ì¼œì¤˜.
- ë§¥ë½ì—ì„œ ë²—ì–´ë‚œ ì´ì•¼ê¸°ë¥¼ í•˜ì§€ë§ˆ.
"""

# âœ… í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="YoungK íŒ¬ ì‘ì› ì±—ë´‡", page_icon="ğŸ¤", layout="centered")

# âœ… CSS ì ìš© (Bubble ìŠ¤íƒ€ì¼ ì±„íŒ…ë°© UI)
st.markdown("""
<style>
body {
    background-color: #F3F0FF;
}
.chat-container {
    background-color: #ffffff;
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 2rem;
    display: flex;
    flex-direction: column;
}
.message {
    border-radius: 1rem;
    padding: 0.7rem 1.1rem;
    margin-bottom: 0.6rem;
    max-width: 80%;
    word-wrap: break-word;
}
.user-msg {
    background-color: #f0f0ff;
    align-self: flex-end;
    border-top-right-radius: 0.1rem;
}
.bot-msg {
    background-color: #fff5db;
    align-self: flex-start;
    border-top-left-radius: 0.1rem;
}
.sender {
    font-weight: bold;
    margin-bottom: 0.3rem;
}
.input-area {
    margin-top: auto;
    background-color: #fff;
    padding: 1rem;
    border-radius: 0.75rem;
}
</style>
""", unsafe_allow_html=True)

# âœ… ì œëª©
st.markdown("## ğŸ¤ <span style='color:#000;'>YoungK íŒ¬ ì‘ì› ì±—ë´‡</span>", unsafe_allow_html=True)
st.markdown("íŒ¬ì˜ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ë©´ YoungKê°€ ë”°ëœ»í•˜ê²Œ ì‘ë‹µí•´ì¤ë‹ˆë‹¤ğŸ’Œ")

# âœ… ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "messages" not in st.session_state:
    st.session_state.messages = [{"role": "system", "content": system_prompt}]
if "user_input" not in st.session_state:
    st.session_state.user_input = ""

# âœ… ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
def send_message():
    user_msg = st.session_state.user_input.strip()
    if user_msg:
        st.session_state.messages.append({"role": "user", "content": user_msg})
        try:
            response = client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=st.session_state.messages
            )
            reply = response.choices[0].message.content
            st.session_state.messages.append({"role": "assistant", "content": reply})
        except Exception as e:
            st.session_state.messages.append({"role": "assistant", "content": f"âš ï¸ ì˜¤ë¥˜ ë°œìƒ: {e}"})
    st.session_state.user_input = ""

# âœ… ì±„íŒ… ì¶œë ¥
st.markdown("<div class='chat-container'>", unsafe_allow_html=True)
for msg in st.session_state.messages[1:]:  # system ë©”ì‹œì§€ëŠ” ì œì™¸
    role = msg["role"]
    sender = "ğŸ‘¤ ë§ˆì´ë°ì´" if role == "user" else "ğŸ¸ YoungK"
    css_class = "user-msg" if role == "user" else "bot-msg"
    st.markdown(
        f"<div class='message {css_class}'>"
        f"<div class='sender'>{sender}</div>{msg['content']}</div>",
        unsafe_allow_html=True
    )
st.markdown("</div>", unsafe_allow_html=True)

# âœ… ì…ë ¥ì°½ (ì±„íŒ… í•˜ë‹¨ + ì—”í„° ì „ì†¡)
st.text_input(
    "íŒ¬ì˜ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”",
    key="user_input",
    on_change=send_message,
    label_visibility="collapsed",
    placeholder="ë§ˆì´ë°ì´ğŸ€ í•˜ê³  ì‹¶ì€ ë§ì„ ì…ë ¥í•´ì¤˜!"
)