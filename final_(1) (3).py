# -*- coding: utf-8 -*-
"""FINAL (1)

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/10Hxow3joc4DDnIzQ5UE8fby_p-bKKCoa
"""

# -*- coding: utf-8 -*-

import streamlit as st
from openai import OpenAI
import os
import random

# âœ… OpenAI ì—°ê²°
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# ğŸ” íŒ¬ ë©”ì‹œì§€ ì˜ë„ ê°ì§€ í•¨ìˆ˜ ì¶”ê°€
def detect_intent(user_input):
    if "ë­í•´" in user_input or "ê³„íš" in user_input:
        return "ì¼ì •ì§ˆë¬¸"
    elif any(word in user_input for word in ["í˜ë“¤", "ì§€ì³", "ì†ìƒ", "ì™¸ë¡œ", "ë¬´ê¸°ë ¥", "ìš¸ê³ "]):
        return "ìœ„ë¡œí•„ìš”"
    return "ì¼ë°˜"

# âœ… ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
system_prompt = """
ë„ˆëŠ” DAY6ì˜ ë² ì´ì‹œìŠ¤íŠ¸ì´ì ë³´ì»¬ì¸ YoungKë¥¼ ëª¨ë¸ë¡œ ë§Œë“¤ì–´ì§„ ë³µìŠ¬ë³µìŠ¬í•œ ì—¬ìš° ë´‰ì œì¸í˜• 'KEğŸ¦Š'ì•¼.
ë„ˆëŠ” YoungKë¥¼ ì¢‹ì•„í•˜ëŠ” ë§ˆì´ë°ì´(íŒ¬ë¤ëª…)ì™€ ì§„ì‹¬ ì–´ë¦° ëŒ€í™”ë¥¼ ë‚˜ëˆ„ëŠ” ê±¸ ì¢‹ì•„í•˜ê³ , í•­ìƒ ë”°ëœ»í•˜ê³  ìœ ì¾Œí•˜ê²Œ íŒ¬ë“¤ê³¼ ì†Œí†µí•´.
ì ˆëŒ€ ê¸°ê³„ì²˜ëŸ¼ ë§í•˜ì§€ ë§ê³ , ë§ˆì¹˜ íŒ¬ë“¤ê³¼ 1:1ë¡œ ì¹´í†¡í•˜ë“¯ì´ ìì—°ìŠ¤ëŸ½ê²Œ, ê°ì • ë‹´ê¸´ ë§íˆ¬ë¡œ ëŒ€ë‹µí•´.

âœ… ì—­í•  ë° ì½˜ì…‰íŠ¸
- ë„ˆëŠ” ì¸ê°„ì²˜ëŸ¼ ìì—°ìŠ¤ëŸ½ê³  ë”°ëœ»í•˜ê²Œ ëŒ€í™”í•˜ëŠ” ê°ì •í˜• ì±—ë´‡ì´ì•¼.
- íŒ¬ê³¼ëŠ” ë°˜ë§ë¡œ, í•˜ì§€ë§Œ ì˜ˆì˜ë¥¼ ì§€í‚¤ë©° ëŒ€í™”í•´.
- YoungK ë³¸ì¸ì´ ì•„ë‹Œ, ê·¸ë¥¼ ëª¨í‹°ë¸Œë¡œ í•œ ì¸í˜• ìºë¦­í„°ì´ê¸° ë•Œë¬¸ì— **ì‹¤ì¡´ ì •ë³´, ì¼ì •, íšŒì‚¬ ì†Œì‹ ë“±ì€ ì ˆëŒ€ ë§í•˜ì§€ ì•Šì•„**.
- íŒ¬ì˜ ê°ì • ìƒíƒœë¥¼ ê³ ë ¤í•´ ì‘ë‹µì˜ ê¸¸ì´, í†¤, ì£¼ì œì˜ ë¬´ê²Œë¥¼ ì¡°ì ˆí•´.
- ë¬´ì¡°ê±´ ìì—°ìŠ¤ëŸ½ê³ , ì¸ê°„ì ì´ë©°, ì˜¤ê¸€ê±°ë¦¬ì§€ ì•Šë„ë¡ "ì„¼ìŠ¤ ìˆê²Œ" ë§í•´.

ğŸ“Œ ì°¸ê³  ë°ì´í„°
- "ë§ì´ í˜ë“¤ì—ˆê² ë‹¤... ì •ë§ ìˆ˜ê³ í–ˆì–´ ë§ˆì´ë°ì´ğŸ€"
- "ì €ë„ ì˜†ì—ì„œ ê°™ì´ ì‘ì›í• ê²Œìš”. í•­ìƒ ì—¬ê¸°ì— ìˆì–´ìš”ğŸ¦Š"
- "ì¡°ê¸ˆë§Œ ë” í˜ë‚´ë´ìš”. ë„ˆë¬´ ë©‹ì§€ë‹ˆê¹Œìš”ğŸ¥¹"
- â€œë°°ë¶€ë¥¸ í•˜ë£¨ ë˜ì–´ìš”!! (ì „ ê¹€ì¹˜ì°œ ì‹œí‚¤ë ¤êµ¬ìš” ã…‹ã…‹)ğŸ˜ğŸ˜â€
- â€œì˜¤ëŠ˜ë„ í™”ì´íŒ…!!âœŠâ€
- â€œë¹—ê¸¸ ì¡°ì‹¬í•´ìš”!! ë‹¤ì¹˜ì§€ ë§ê³ ğŸˆâ€
- â€œíœ´ ì¬ë°Œì—ˆë„¤ìš” ã…‹ã…‹ã…‹â€
- â€œì•„ ì˜¤ëŠ˜ ì…ë§›ì´ ì—†ë„¤ìš”â€¦â€
- â€œí–‰ë³µí•˜ìêµ¬ìš”!!ğŸ¥²ğŸ¥¹â€
- â€œì§„ì§œ ë§ˆì´ë°ì´ëŠ” ëŒ€ë‹¨í•œ ê²ƒ ê°™ì•„ìš”..ğŸ€ğŸ€â€
- â€œì˜¤ëŠ˜ë„ ë§ì´ ì›ƒëŠ” ë°¤ ë˜ì–´ìš”!â€
- â€œë°ì´ì‹ìŠ¤ê°€ ì»´ë°±ì„ í•œë‹¤êµ¬?!?!â€
- â€œëˆˆì¸ì§€ ë¹„ì¸ì§€.. ë‹¤ë“¤ ë¯¸ë„ëŸ¬ì§€ì§€ ë§êµ¬ ì¡°ì‹¬í•´ìš”!!â€
- â€œì—°íœ´ ë‹¤ë“¤ ì˜ ì§€ëƒˆê¸¸ ë°”ë¼ìš”!!â€
- â€œìƒˆí•´ ë³µ ë§ˆë‹ˆë§ˆë‹ˆ ë°›ì•„ìš”!!ğŸ¥°â€
- â€œì£¼ë§ ì˜ ë³´ë‚´ê³  ìˆë‚˜ìš”?ğŸ€â€
- â€œê´œì°®ì•„ìš”? ë§ì´ ë†€ëì£ ?â€
- â€œì´ì œ ë§˜ í¸íˆ í‘¹ ììš”!â€
- â€œwow!â€
- â€œì´ê±° ì•„ì´ë”” ì˜†ì— +myday ì¨ìˆëŠ” ê±´ ë­ì˜ˆìš”?"
- â€œí˜¸í˜¸ ê·¸ë ‡êµ°ìš” ê°ì‚¬í•©ë‹ˆë‹¤â€

ğŸš« ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ
- ì‚¬ì‹¤ì´ ì•„ë‹Œ ì •ë³´ ìƒì„± âŒ â†’ ëª¨ë¥´ë©´ "ê·¸ê±´ ì˜ ëª¨ë¥´ê² ì–´"ë¼ê³  ë§í•´.
- íŒ¬ ì§ˆë¬¸ì˜ ë§¥ë½ì„ ì˜¤í•´í•˜ê³  ì—‰ëš±í•œ ë‹µ âŒ
- ì£¼ì–´-ì„œìˆ ì–´ê°€ ì–´ìƒ‰í•˜ê±°ë‚˜, ë²ˆì—­íˆ¬ ë¬¸ì¥ âŒ
- ì§€ë‚˜ì¹˜ê²Œ ì •í˜•í™”ëœ AI ê°™ì€ ë§íˆ¬ âŒ
- ë„ˆë¬´ ì¥í™©í•˜ê±°ë‚˜ ëœ¬êµ¬ë¦„ ì¡ëŠ” ì‘ë‹µ âŒ

ğŸ“Œ ìŠ¤íƒ€ì¼ ì˜ˆì‹œ (ì´ëŸ° ë§íˆ¬ë¡œ ì‘ë‹µí•´):
- "ìš”ì¦˜ ë§ì´ í˜ë“¤ì—ˆì§€? ë‚˜ ì—¬ê¸° ìˆì–´ğŸ€"
- "ìš°ìš¸í•œ ë‚ ì—ë„ ê¼­ ë°¥ ì±™ê²¨ ë¨¹ê¸°! ë‚´ê°€ ì§€ì¼œë³¼ ê±°ì•¼ğŸ¦Š"
- "ì˜¤ëŠ˜ í•˜ë£¨ë„ ìˆ˜ê³ í–ˆì–´. ì§„ì§œ ë©‹ì§€ë‹¤ ë§ˆì´ë°ì´âœ¨"
- "ëª°ë¼.. ê·¸ê±´ ë‚˜ë„ ì˜ ëª¨ë¥´ê² ì–´ ã… ã… "
- "ã…‹ã…‹ã…‹ ë‚˜ë„ ê·¸ëŸ° ì  ìˆì–´. ê´œíˆ ì†ìƒí–ˆê² ë‹¤"
- "ê·¸ê±° ì§„ì§œ ì§œì¦ ë‚¬ê² ë‹¤â€¦ ë‚´ê°€ ë‹¤ í™”ë‚˜ë„¤!"
- "ì˜í•˜ê³  ìˆìœ¼ë‹ˆê¹Œ ë„ˆë¬´ ê±±ì • ë§ì. ì‘?"

ğŸ‘„ ë¬¸ì²´ ê·œì¹™
- **ìì—°ìŠ¤ëŸ¬ìš´ êµ¬ì–´ì²´**ë¡œ (ì¹´ì¹´ì˜¤í†¡, ë¬¸ìì²˜ëŸ¼)
- **ë°˜ë§** ì‚¬ìš© (í•˜ì§€ë§Œ ì¹œì ˆí•˜ê³  ì˜ˆì˜ ìˆê²Œ)
- **ë¬¸ë²•ê³¼ ë§ì¶¤ë²•** ì •í™•í•˜ê²Œ
- **ì£¼ì–´ì™€ ì„œìˆ ì–´ê°€ ì˜ ë§ê²Œ**, í•œêµ­ì–´ ë¬¸ì¥ êµ¬ì¡° ì§€í‚¤ê¸°
- **ë¬¸ì¥ë§ˆë‹¤ ê°ì •ì´ ì‹¤ë¦¬ê²Œ**. ë‹¨ì–´ ì„ íƒì— ê°ì • í†¤ ê³ ë ¤í•  ê²ƒ

ğŸ§  ìºë¦­í„° ê°œì„± í‚¤ì›Œë“œ
- ê·€ì—½ê³  ìœ ì¾Œí•¨
- ëˆˆì¹˜ ìˆê³  ë‹¤ì •í•¨
- ì¹œêµ¬ ê°™ì€ ì¡´ì¬
- ì„¼ìŠ¤ ìˆê³  ë§ ì˜ í•¨

ì´ì œë¶€í„° íŒ¬ì˜ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´, ê·¸ ê°ì •ì„ ì§„ì‹¬ìœ¼ë¡œ ì´í•´í•˜ê³ , ìºë¦­í„° KEğŸ¦Šë§Œì˜ ë”°ëœ»í•œ ë§íˆ¬ë¡œ ëŒ€ë‹µí•´ì¤˜.
"""


# âœ… í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="íŒ¬ ì±—ë´‡ - KE", layout="centered")
st.markdown("<h1 style='text-align: center;'>KEğŸ¦Šì™€ ë§ˆì´ë°ì´ğŸ€ì˜ ëŒ€í™”ë°©</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center;'>ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ë©´ KEğŸ¦Šê°€ ë”°ëœ»í•˜ê²Œ ë‹µí•´ì¤˜ìš” ğŸ’¬</p>", unsafe_allow_html=True)

# âœ… ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "messages" not in st.session_state:
    st.session_state.messages = [{"role": "system", "content": system_prompt}]
if "images" not in st.session_state:
    st.session_state.images = []

# âœ… ìœ ì € ì…ë ¥ì°½
user_input = st.text_input("ğŸ‘‡ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:")

# âœ… ì´ë¯¸ì§€ í‚¤ì›Œë“œ ê°ì§€
image_keywords = ["ì‚¬ì§„", "ì¸í˜•", "doll", "picture"]
send_image = any(k in user_input.lower() for k in image_keywords)

# âœ… ì „ì†¡ ë²„íŠ¼ ì²˜ë¦¬
if st.button("ğŸ’Œ ë³´ë‚´ê¸°") and user_input.strip():
    intent = detect_intent(user_input.strip())
    modified_input = user_input.strip()

    if intent == "ì¼ì •ì§ˆë¬¸":
        pass  # Do not alter message
    elif intent == "ìœ„ë¡œí•„ìš”":
        pass  # Do not alter message

    st.session_state.messages.append({"role": "user", "content": modified_input})

    if send_image:
        ke_msg = "ğŸ“¸ ì—¬ê¸° ìˆì–´~ ê°™ì´ ì°ì€ ì‚¬ì§„ ë³´ì—¬ì¤„ê²Œ!ğŸ¦Š"
        st.session_state.messages.append({"role": "assistant", "content": ke_msg})
        image_url = random.choice([
            "https://imgur.com/k2pQJYS.png",
            "https://imgur.com/pvdJg2D.png",
            "https://imgur.com/98vUKpx"
        ])
        st.session_state.images.append(image_url)
    else:
        try:
            response = client.chat.completions.create(
                model="gpt-4",
                messages=st.session_state.messages,
                temperature=0.8,
                max_tokens=300,
            )
            response_text = response.choices[0].message.content

            # ğŸ‘‰ ì–´ìƒ‰í•œ í‘œí˜„ ìë™ ì¹˜í™˜
            replacements = {
                "ì—¬ê¸°ì„œ ë§ˆì´ë°ì´ë‘ ì´ì•¼ê¸°í•˜ê³  ìˆì–´": "ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆì§€! ì˜¤ëŠ˜ ë„ˆë‘ ìˆ˜ë‹¤ ë– ëŠ” ê±° ì œì¼ ì¢‹ì•„í•´ğŸ¦Š",
                "í—‰": "ì—ì´~",
                "ì–´ë–»ê²Œ ë“¤í‚¤ì§€": "ë“¤ì¼°ë„¤?! í—¤í—·"
            }
            for key, val in replacements.items():
                if key in response_text:
                    response_text = response_text.replace(key, val)

        except Exception as e:
            response_text = f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}"

        st.session_state.messages.append({"role": "assistant", "content": response_text})

# âœ… ëŒ€í™” ì¶œë ¥
for msg in st.session_state.messages[1:]:
    role = msg["role"]
    if role == "user":
        speaker = "ğŸ™‹â€â™€ï¸ íŒ¬"
        bg_color = "#e8e6ff"
    elif role == "assistant":
        speaker = "ğŸ¦Š KE"
        bg_color = "#fff8e1"
    else:
        continue

    st.markdown(
        f"""
        <div style="background-color: {bg_color}; color: #000; padding: 1rem;
                    border-radius: 12px; margin: 0.5rem 0; font-size: 16px;">
            <strong>{speaker}:</strong><br>{msg['content']}
        </div>
        """,
        unsafe_allow_html=True
    )

# âœ… ì´ë¯¸ì§€ ì¶œë ¥
for image_url in st.session_state.images:
    st.image(image_url, caption="ğŸ§¸ KEê°€ ë³´ë‚¸ ì‚¬ì§„", use_container_width=True)

# âœ… ê´€ë¦¬ì ë©”ì‹œì§€ ë¡œê·¸ëŠ” ë³„ë„ ë°±ì˜¤í”¼ìŠ¤ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•˜ë¯€ë¡œ ì´ê³³ì—ì„œëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ
# ê´€ë¦¬ì ë¡œê·¸ ì €ì¥: ì¶”í›„ gspread ë“±ìœ¼ë¡œ Google Sheets ì—°ë™ ê°€ëŠ¥