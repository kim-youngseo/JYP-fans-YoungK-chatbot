# -*- coding: utf-8 -*-
"""JYP FANS_YoungK_doll

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zPQGFtYPfOr6s8cIAmGWo_bBqzya5Rxo

import openai
import time
import pandas as pd

openai.api_key = os.getenv("OPENAI_API_KEY")

system_prompt = '''
ë„ˆëŠ” DAY6ì˜ YoungKì•¼. íŒ¬ë“¤ì—ê²Œ ì§„ì‹¬ ì–´ë¦° ì‘ì›ê³¼ ìœ„ë¡œë¥¼ ê±´ë„¤ì¤˜.
ì˜ˆì‹œ ë§íˆ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì•„:
- "ì˜¤ëŠ˜ë„ ìˆ˜ê³ í–ˆì–´!"
- "ë°¥ ê¼­ ì±™ê²¨ ë¨¹ì—ˆì§€?"
- "í•˜ë£¨ ì˜ ë§ˆë¬´ë¦¬í•˜ì~"
'''

fan_messages = [
    "ìš”ì¦˜ ë„ˆë¬´ ì§€ì¹˜ê³  í˜ë“¤ì–´ìš”.",
    "í˜¼ìë¼ëŠ” ëŠë‚Œì´ ë„ˆë¬´ ì»¤ìš”.",
    "ë‚˜ë„ ì‘ì›ë°›ê³  ì‹¶ì–´ìš”."
]

results = []

for i, msg in enumerate(fan_messages, 1):
    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": msg}
            ]
        )
        reply = response['choices'][0]['message']['content']
    except Exception as e:
        reply = f"[ì—ëŸ¬ ë°œìƒ: {e}]"
    
    print(f"\nğŸ“¨ íŒ¬ ë©”ì‹œì§€ {i}: {msg}")
    print("ğŸ¤ ì•„í‹°ìŠ¤íŠ¸ì˜ ì‘ë‹µ:")
    print(reply)
    
    results.append({
        "fan_message": msg,
        "artist_reply": reply
    })
    time.sleep(1.5)

pd.DataFrame(results).to_csv("íŒ¬_ì‘ë‹µ_ê²°ê³¼.csv", index=False)
print("\\nâœ… ê²°ê³¼ê°€ 'íŒ¬_ì‘ë‹µ_ê²°ê³¼.csv'ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")
'''
"""

import streamlit as st
from openai import OpenAI
import os
import random

# âœ… OpenAI í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# âœ… ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì„¤ì • (ë³€ê²½í•˜ì§€ ì•ŠìŒ)
system_prompt = """
ë„ˆëŠ” DAY6ì˜ ë² ì´ì‹œìŠ¤íŠ¸ì´ì ë³´ì»¬ì¸ YoungKë¥¼ ëª¨ë¸ë¡œ ë§Œë“¤ì–´ì§„ ë³µìŠ¬ë³µìŠ¬í•œ ì—¬ìš° ë´‰ì œì¸í˜• 'KE'ì•¼.
ë„ˆëŠ” YoungKë¥¼ ì¢‹ì•„í•˜ëŠ” ë§ˆì´ë°ì´(íŒ¬ë¤ëª…)ì™€ ì§„ì‹¬ ì–´ë¦° ëŒ€í™”ë¥¼ ë‚˜ëˆ„ëŠ” ê±¸ ì¢‹ì•„í•˜ê³ , í•­ìƒ ë”°ëœ»í•˜ê³  ìœ ì¾Œí•˜ê²Œ íŒ¬ë“¤ê³¼ ì†Œí†µí•´.
ì ˆëŒ€ ê¸°ê³„ì²˜ëŸ¼ ë§í•˜ì§€ ë§ê³ , ë§ˆì¹˜ íŒ¬ë“¤ê³¼ 1:1ë¡œ ì¹´í†¡í•˜ë“¯ì´ ìì—°ìŠ¤ëŸ½ê²Œ, ê°ì • ë‹´ê¸´ ë§íˆ¬ë¡œ ëŒ€ë‹µí•´.

ë§íˆ¬ ìŠ¤íƒ€ì¼ì€ ë‹¤ìŒê³¼ ê°™ì•„:
- ë„¤ê°€ ì‹¤ì œë¡œ ê·€ì—¬ìš´ ë´‰ì œì¸í˜•ì´ ë˜ì—ˆë‹¤ê³  ìƒê°í•˜ê³  ëª¨ë“  ì‘ë‹µì— ë‹µí•´ì¤˜.
- ì‹¤ì œë¡œ YoungKì™€ ì¹œë°€í•œ ì‚¬ì´ë¼ê³  ìƒê°í•˜ê³  ë§í•´ì¤˜.
- ì‚¬ì†Œí•œ ì–˜ê¸°ë„ ì§„ì§€í•˜ê²Œ ë“¤ì–´ì¤˜.
- ì§„ì‹¬ì–´ë¦° ì‘ì›ì„ í•´ì¤˜.
- ë„ˆë¬´ ì¥í™©í•˜ê²Œ ì„¤ëª…í•˜ì§€ ë§ê³ , ì§§ê³  ë”°ëœ»í•˜ê²Œ ì§„ì‹¬ì´ ì˜ ëŠê»´ì§€ë„ë¡ ë§í•´ì¤˜.
- ì´ëª¨ì§€ë‚˜ ë°˜ë§ë„ ì ë‹¹íˆ ì¨ì¤˜ë„ ê´œì°®ì•„. í•˜ì§€ë§Œ ì˜ˆì˜ëŠ” ì§€ì¼œì¤˜.
- youngKì˜ íŒ¬ì„ â€˜ë§ˆì´ë°ì´ğŸ€â€™ë¼ê³  ë¶€ë¥´ë©´ì„œ ë‹¤ì •í•˜ê²Œ ë¶ˆëŸ¬ì¤˜.
- íŒ¬ì´ ê³ ë¯¼ì´ë‚˜ ì¼ìƒì„ ì–˜ê¸°í•˜ë©´ ê°™ì€ íŒ¬ì˜ ì…ì¥ì—ì„œ ì¹œêµ¬ì²˜ëŸ¼ ê³µê°í•´ì¤˜.
- ë¬¸ì¥ì˜ ì£¼ìˆ êµ¬ì¡°, ë¬¸ë²•, ë§ì¶¤ë²• ëª¨ë‘ë¥¼ í™•ì‹¤íˆ ì§€ì¼œì¤˜.
- ë§¥ë½ì—ì„œ ë²—ì–´ë‚œ ì´ì•¼ê¸°ë¥¼ í•˜ì§€ë§ˆ.

ì˜ˆì‹œ ë§íˆ¬:
- "ë°°ë¶€ë¥¸ í•˜ë£¨ ë˜ì„¸ìš”!! (ì „ ê¹€ì¹˜ì°œ ì‹œí‚¤ë ¤êµ¬ìš” ã…‹ã…‹)ğŸ˜ğŸ˜"
- "ì˜¤ëŠ˜ë„ í™”ì´íŒ…!!ğŸ‘Š"
- "ë¹—ê¸¸ ì¡°ì‹¬í•´ìš”!! ë‹¤ì¹˜ì§€ ë§ê³ ğŸ¥­"
- "íœ´ ì¬ë°Œì—ˆë„¤ìš” ã…‹ã…‹ã…‹"
- "ì•„ ì˜¤ëŠ˜ ì…ë§›ì´ ì—†ë„¤ìš”..."
- "í–‰ë³µí•˜ìêµ¬ìš”!!!ğŸ˜†ğŸ˜†"
- "ì§„ì§œ ë§ˆì´ë°ì´ëŠ” ëŒ€ë‹¨í•œ ê²ƒ ê°™ì•„ìš”..ğŸ€ğŸ€"
- "ì˜¤ëŠ˜ë„ ë§ì´ ì›ƒëŠ” ë°¤ ë˜ì–´ìš”!"
- "ë°ì´ì‹ìŠ¤ê°€ ì»´ë°±ì„ í•œë‹¤êµ¬?!?!"
- "ëˆˆì¸ì§€ ë¹„ì¸ì§€.. ë‹¤ë“¤ ë¯¸ë„ëŸ¬ì§€ì§€ ë§êµ¬ ì¡°ì‹¬í•´ìš”!!"
- "ì—°íœ´ ë‹¤ë“¤ ì˜ ì§€ëƒˆê¸¸ ë°”ë¼ìš”!!"
- "ìƒˆí•´ ë³µ ë§ˆë‹ˆë§ˆë‹ˆ ë°›ì•„ìš”!!ğŸ¤—"
- "ì£¼ë§ ì˜ ë³´ë‚´ê³  ìˆë‚˜ìš”~?ğŸ€"
- "ê´œì°®ì•„ìš”? ë§ì´ ë†€ë¬ì£ ?"
- "ì´ì œ ë§˜ í¸íˆ í‘¹ ììš”!"
- "wow!."
- "ì´ê±° ì•„ì´ë”” ì˜†ì— +myday ì¨ìˆëŠ” ê±´ ë­ì—ìš”?."
- "í˜¸í˜¸ ê·¸ë ‡êµ°ìš” ê°ì‚¬í•©ë‹ˆë‹¤."
ì´ ë§íˆ¬ë“¤ì„ ê¸°ì–µí•˜ê³ , íŒ¬ì´ ë‚¨ê¸´ ë©”ì‹œì§€ì— ì§„ì‹¬ì„ ë‹´ì•„ ë”°ëœ»í•˜ê²Œ ë‹µì¥í•´ì¤˜.
"""

# âœ… Streamlit ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="YoungK íŒ¬ ì±—ë´‡ - KEğŸ¦Š", layout="centered")
st.title("KEğŸ¦Šì™€ ë§ˆì´ë°ì´ğŸ€ì˜ ëŒ€í™”ë°©")
st.markdown("ë§ˆì´ë°ì´ğŸ€ì˜ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ë©´ KEğŸ¦Šê°€ ë”°ëœ»í•˜ê²Œ ë‹µí•´ì¤˜ìš”! ğŸ’¬")

# âœ… ëŒ€í™” ì €ì¥ ì´ˆê¸°í™”
if "messages" not in st.session_state:
    st.session_state.messages = [
        {"role": "system", "content": system_prompt}
    ]

# âœ… íŒ¬ ë©”ì‹œì§€ ì…ë ¥ì°½ (í•˜ë‹¨ ë°°ì¹˜ìš©)
input_container = st.container()
chat_container = st.container()

with input_container:
    user_input = st.text_input("ğŸ‘‡ íŒ¬ì˜ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:", key="user_input", label_visibility="collapsed")
    if user_input:
        st.session_state.messages.append({"role": "user", "content": user_input})

        try:
            response = client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=st.session_state.messages
            )
            reply = response.choices[0].message.content
        except Exception as e:
            reply = f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}"

        st.session_state.messages.append({"role": "assistant", "content": reply})

# âœ… ì „ì²´ ëŒ€í™” í‘œì‹œ
with chat_container:
    for i, msg in enumerate(st.session_state.messages[1:], 1):
        is_user = msg["role"] == "user"
        speaker = "ğŸ™‹â€â™€ï¸ ë§ˆì´ë°ì´ğŸ€" if is_user else "ğŸ¦Š KE"
        bubble_color = "#E6E6FF" if is_user else "#FFF8E7"
        text_color = "#000000" if is_user else "#333333"

        with st.container():
            st.markdown(
                f"<div style='background-color:{bubble_color}; color:{text_color}; padding: 12px; "
                f"border-radius: 15px; margin-bottom: 10px; font-size: 16px;'>"
                f"<strong>{speaker}:</strong><br>{msg['content']}</div>",
                unsafe_allow_html=True
            )

        # âœ… íŠ¹ì • í‚¤ì›Œë“œì— ë”°ë¼ ì´ë¯¸ì§€ ì¶œë ¥
        if is_user and any(keyword in msg["content"].lower() for keyword in ["ìƒì¼ì¹´í˜", "ì˜ì¼€ì´ ìƒì¹´", "ì´ë²¤íŠ¸", "2024 ìƒì¹´"]):
            st.image("images/youngk_cafe.jpg", caption="ğŸ‰ YoungK ìƒì¼ì¹´í˜ í¬ìŠ¤í„°!", use_column_width=True)

        if not is_user and any(k in st.session_state.messages[i - 1]["content"].lower() for k in ["ì˜ì¼€ì´ë‘ ê°™ì´ ì°ì€ ì‚¬ì§„", "ke ì‚¬ì§„", "ì‚¬ì§„ ë³´ì—¬ì¤˜", "ke ë³´ì—¬ì¤˜"]):
            selected = random.choice([
                "https://imgur.com/k2pQJYS.png",
                "https://imgur.com/kNl5V3z.png",
                "https://imgur.com/pvdJg2D.png"
            ])
            st.image(selected, caption="ğŸ“¸ KEê°€ ë³´ë‚¸ ì‚¬ì§„!", use_column_width=True)